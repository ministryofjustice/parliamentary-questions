

<%= render partial: "shared/flash_messages", flash: flash %>
<h2>
  <span class="uin">PQ Details - <%= @pq.uin %></span>
  <% if @pq.question_type == 'NamedDay' %>
      <span class="label label-primary" title="Named day">N</span>
  <% end %>
  <% if @pq.question_type == 'Ordinary' %>
      <span class="label label-info" title="Ordinary Written">O</span>
  <% end %>
  <% if @pq.transferred  %>
      <span class="label label-warning" title="Transferred">Transferred</span>
  <% end %>
</h2>
<div id='trim_area_<%= @pq.id %>'>
  <%= render partial: 'shared/trim_links', locals: {question: @pq} %>
</div>

<div id="progress-menu">
  <div id="progress-menu-pq" class="progress-menu-item">PQ</div>
  <div id="progress-menu-fc" class="progress-menu-item">Finance check</div>
  <div id="progress-menu-com" class="progress-menu-item">PQ commission</div>
  <div id="progress-menu-ao" class="progress-menu-item">Action Officer allocation</div>
  <div id="progress-menu-sub" class="progress-menu-item">Draft submission</div>
  <div id="progress-menu-pod" class="progress-menu-item">POD check</div>
  <div id="progress-menu-min" class="progress-menu-item">Minister check</div>
  <div id="reset"><span class="fa fa-caret-right"></span>Reset PQ</div>
</div>



<%= form_for @pq, :url => { :action => "update", :id => @pq[:uin] }, :html=>{ :class=>'progress-menu-form start-hidden' } do |f| %>


<div id="progress-menu-pq-data" class="progress-menu-data start-hidden">
  <div>
    <%= render partial: 'shared/deadline_time', locals: {internal_deadline: @pq.internal_deadline} %>
  </div>
  <div>
    <div>
        <div>
          <% if !@pq.preview_url.nil? %>
            <a href="<%= @pq.preview_url %>">Question in Q&A Tool</a>
          <% end %>
        </div>
        <div>
        Tabling Member: <%= @pq.member_name %>
        </div>
        <div>
        Constituency: <%= @pq.member_constituency %>
        </div>
        <div>
        House: <%= @pq.house_name %>
        </div>
        <div>
          Replying minister: <%= @pq.minister.name unless @pq.minister_id.nil? %></span>
        </div>
        <% if !@pq.policy_minister_id.nil? %>
        <div>
          <span>Policy minister: <%= @pq.policy_minister.name %></span>
        </div>
        <% end %>
    </div>
  </div>
  <div>

    <div>
    	<span class="date">Date For Answer: <%= @pq.date_for_answer.strftime('%d/%m/%Y') unless @pq.date_for_answer.nil? %></span>
  	</div>
  	<div>
    	<span class="date">Date Tabled: <%= @pq.tabled_date.strftime('%d/%m/%Y') unless @pq.tabled_date.nil? %></span>
  	</div>
  </div>
  <div>
    <%= @pq.question %>
  </div>

      <% if @pq.registered_interest %>
     <div>
      <span>Member has registered an interest in the Question.</span>
     </div>
    <% end %>

      <div class="minister-info">
        <label>Set replying minister</label>
        <%= f.collection_select(:minister_id, @minister_list, :id, :name, :include_blank => "Please select") %>
      </div>
      <div class="minister-info">
        <label>Set optional policy minister</label>
        <%= f.collection_select(:policy_minister_id, @minister_list, :id, :name, :include_blank => "Only select if needed") %>
      </div>
</div>
<div id="progress-menu-fc-data" class="progress-menu-data start-hidden">
  <div class="checkbox">
    <%= f.label(:seen_by_finance) %>
    <%= f.check_box(:seen_by_finance) %>
  </div>
  <div class="checkbox">
    <%= f.label(:finance_interest) %>
    <%= f.check_box(:finance_interest) %>
  </div>
</div>
<div id="progress-menu-com-data" class="progress-menu-data start-hidden">
  <div class="deadline_input">
    Internal deadline
    <div class='input-group date datetimepicker' id='datetimepicker1' data-date-format="DD/MM/YYYY HH:mm">
      <input class="form-control" id="pq_internal_deadline" name="pq[internal_deadline]" type="text" value="<%= @pq.internal_deadline.strftime('%d/%m/%Y %H:%M') unless @pq.internal_deadline.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
    </div>
  </div>
  <!-- loop through and show rejection reasons -->
  <%= render partial:'shared/rejected_reasons', locals: {question: @pq} %>

  <div class="question-allocation">
    <div>Allocation:</div>
<% @pq.action_officers_pq.each do |ao_pq|   %>
  <% if ao_pq %>
    <div><%= ao_pq.action_officer.name  %> <%= link_to "Edit #{ao_pq.action_officer.name}", edit_action_officer_path(ao_pq.action_officer)  %></div>
    <div>Email: <%= mail_to ao_pq.action_officer.email %></div>
    <div>Phone: <%= ao_pq.action_officer.phone %></div>
    <div>Directorate: <%= ao_pq.action_officer.deputy_director.division.directorate.name %></div>
    <div>Division: <%= ao_pq.action_officer.deputy_director.division.name %></div>
    <div>Deputy director: <%= ao_pq.action_officer.deputy_director.name %></div>
    <div>Press Office: <%= ao_pq.action_officer.press_desk.name %></div>
    <% ao_pq.action_officer.press_desk.press_officers.each do |po|   %>
    <div><%= mail_to po.name, po.email %></div>
    <% end %>
 <% end %>
<% end %>

  </div>
</div>
<div id="progress-menu-ao-data" class="progress-menu-data start-hidden">
    <h2>Placeholder for Action Officer Alocation</h2>
</div>
<div id="progress-menu-sub-data" class="progress-menu-data start-hidden">

	<label>Submit Draft Answer</label>

    <div class="trim_dates">
      <div style="float:left; margin:5px;"><label for="draft_answer_received">Draft Answer Received</label>
      </div> 
	   <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker2" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="draft_answer_received" name="pq[draft_answer_received]" type="text" value="<%= @pq.draft_answer_received.strftime('%d/%m/%Y %H:%M') unless @pq.draft_answer_received.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>

    <div class="trim_dates">
      <div style="float:left; margin:5px;"><label for="i_will_write_estimate">I will write estimate</label>
	  </div>
       <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker3" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="i_will_write_estimate" name="pq[i_will_write_estimate]" type="text" value="<%= @pq.i_will_write_estimate.strftime('%d/%m/%Y %H:%M') unless @pq.i_will_write_estimate.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
	
    <div class="trim_dates">
      <div style="float:left; margin:5px;">
		  <label for="holding_reply">Holding Reply</label>
       </div>
	    <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker4" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="holding_reply" name="pq[holding_reply]" type="text" value="<%= @pq.holding_reply.strftime('%d/%m/%Y %H:%M') unless @pq.holding_reply.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
</div>
<div id="progress-menu-pod-data" class="progress-menu-data start-hidden" >

	<label>POD Checking</label>

    <div class="trim_dates">
      <div style="float:left; margin:5px;"><label for=" pod_waiting">Pod Waiting</label>
      </div> 
	   <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker5" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="pod_waiting" name="pq[pod_waiting]" type="text" value="<%= @pq.pod_waiting.strftime('%d/%m/%Y %H:%M') unless @pq.pod_waiting.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>

    <div class="trim_dates">
      <div style="float:left; margin:5px;"><label for="i_will_write_estimate">POD Query</label>
	  </div>
       <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker6" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="pod_query" name="pq[pod_query]" type="text" value="<%= @pq.pod_query.strftime('%d/%m/%Y %H:%M') unless @pq.pod_query.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
	
    <div class="trim_dates">
      <div style="float:left; margin:5px;">
		  <label for="holding_reply">POD Clearance</label>
       </div>
	    <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker7" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="pod_clearance" name="pq[pod_clearance]" type="text" value="<%= @pq.pod_clearance.strftime('%d/%m/%Y %H:%M') unless @pq.pod_clearance.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
</div>
<div id="progress-menu-min-data" class="progress-menu-data start-hidden" >

	<label>Ministerial Answer</label>

    <div class="trim_dates">
      <div style="float:left; margin:5px;"><label for="sent_to_answering_minister">Sent to Answering Minister</label>
      </div> 
	   <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker8" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="sent_to_answering_minister" name="pq[sent_to_answering_minister]" type="text" value="<%= @pq.sent_to_answering_minister.strftime('%d/%m/%Y %H:%M') unless @pq.sent_to_answering_minister.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>

    <div class="trim_dates">
      <div style="float:left; margin:5px;"><label for="ministerial_waiting">Ministerial Waiting</label>
	  </div>
       <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker9" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="ministerial_waiting" name="pq[ministerial_waiting]" type="text" value="<%= @pq.ministerial_waiting.strftime('%d/%m/%Y %H:%M') unless @pq.ministerial_waiting.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
	
    <div class="trim_dates">
      <div style="float:left; margin:5px;">
		  <label for="ministerial_query">Ministerial Query</label>
       </div>
	    <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker10" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="ministerial_query" name="pq[ministerial_query]" type="text" value="<%= @pq.ministerial_query.strftime('%d/%m/%Y %H:%M') unless @pq.ministerial_query.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
	
    <div class="trim_dates">
      <div style="float:left; margin:5px;">
		  <label for="holding_reply">Ministerial Clearance</label>
       </div>
	    <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker11" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="ministerial_clearance" name="pq[ministerial_clearance]" type="text" value="<%= @pq.ministerial_clearance.strftime('%d/%m/%Y %H:%M') unless @pq.ministerial_clearance.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
    <div class="trim_dates">
      <div style="float:left; margin:5px;">
		  <label for="holding_reply">Sent Back to Action Officer</label>
       </div>
	    <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker12" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="sent_back_to_action_officer" name="pq[sent_back_to_action_officer]" type="text" value="<%= @pq.sent_back_to_action_officer.strftime('%d/%m/%Y %H:%M') unless @pq.sent_back_to_action_officer.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
    <div class="trim_dates">
      <div style="float:left; margin:5px;">
		  <label for="holding_reply">Returned by Action Officer</label>
       </div>
	    <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker13" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="returned_by_action_officer" name="pq[returned_by_action_officer]" type="text" value="<%= @pq.returned_by_action_officer.strftime('%d/%m/%Y %H:%M') unless @pq.returned_by_action_officer.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
    <div class="trim_dates">
      <div style="float:left; margin:5px;">
		  <label for="holding_reply">Resubmitted to Minister</label>
       </div>
	    <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker14" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="resubmitted_to_minister" name="pq[resubmitted_to_minister]" type="text" value="<%= @pq.resubmitted_to_minister.strftime('%d/%m/%Y %H:%M') unless @pq.resubmitted_to_minister.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
    <div class="trim_dates">
      <div style="float:left; margin:5px;">
		  <label for="holding_reply">Sign Off from Minister</label>
       </div>
	    <div class="input-group date datetimepicker pq-details-datetime-right" id="datetimepicker15" data-date-format="DD/MM/YYYY HH:mm">
		<input class="form-control" id="sign_off_from_minister" name="pq[sign_off_from_minister]" type="text" value="<%= @pq.sign_off_from_minister.strftime('%d/%m/%Y %H:%M') unless @pq.sign_off_from_minister.nil? %>">
        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
        </span>
      </div>
    </div>
</div>

<div>
        <label>Progress of answer</label>
        <%= f.collection_select(:progress_id, @progress_list, :id, :name) %>
</div>
<p>
<%= f.submit 'Update', :class => 'button' %>
</p>

<% end %>





